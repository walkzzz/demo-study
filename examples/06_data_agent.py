"""
ç¤ºä¾‹ 06: æ•°æ®åˆ†ææ™ºèƒ½ä½“
æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨ DataAgent è¿›è¡Œæ•°æ®åˆ†æå’Œå¯è§†åŒ–
"""

import sys
from pathlib import Path

# æ·»åŠ é¡¹ç›®æ ¹ç›®å½•åˆ°Pythonè·¯å¾„
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

from src.tools import DataTools


def example_1_load_data():
    """ç¤ºä¾‹1: æ•°æ®åŠ è½½"""
    print("\n" + "="*60)
    print("ğŸ“Š ç¤ºä¾‹1: æ•°æ®åŠ è½½")
    print("="*60)
    
    # æ¨¡æ‹Ÿä¸åŒæ ¼å¼çš„æ•°æ®åŠ è½½
    data_sources = [
        {"format": "CSV", "file": "sales_data.csv", "rows": 500, "cols": 8},
        {"format": "Excel", "file": "financial_report.xlsx", "rows": 1200, "cols": 12},
        {"format": "JSON", "file": "customer_data.json", "rows": 350, "cols": 6},
    ]
    
    print("\næ”¯æŒçš„æ•°æ®æ ¼å¼:")
    for source in data_sources:
        print(f"\n  ğŸ“„ {source['format']} æ–‡ä»¶")
        print(f"     æ–‡ä»¶å: {source['file']}")
        print(f"     æ•°æ®è§„æ¨¡: {source['rows']} è¡Œ Ã— {source['cols']} åˆ—")
        print(f"     âœ… åŠ è½½æˆåŠŸ")


def example_2_data_cleaning():
    """ç¤ºä¾‹2: æ•°æ®æ¸…æ´—"""
    print("\n" + "="*60)
    print("ğŸ§¹ ç¤ºä¾‹2: æ•°æ®æ¸…æ´—")
    print("="*60)
    
    # æ¨¡æ‹ŸåŸå§‹æ•°æ®é—®é¢˜
    data_issues = {
        "æ€»è®°å½•æ•°": 1000,
        "ç¼ºå¤±å€¼": 45,
        "é‡å¤è®°å½•": 12,
        "å¼‚å¸¸å€¼": 8,
        "æ ¼å¼é”™è¯¯": 5
    }
    
    print("\nåŸå§‹æ•°æ®è´¨é‡æ£€æŸ¥:")
    for issue, count in data_issues.items():
        status = "âš ï¸ " if count > 0 else "âœ…"
        print(f"  {status} {issue}: {count}")
    
    print("\næ‰§è¡Œæ•°æ®æ¸…æ´—...")
    
    cleaning_steps = [
        ("å¤„ç†ç¼ºå¤±å€¼", "ä½¿ç”¨å¹³å‡å€¼å¡«å……æ•°å€¼åˆ—", 45),
        ("åˆ é™¤é‡å¤è®°å½•", "åŸºäºå…³é”®å­—æ®µå»é‡", 12),
        ("å¤„ç†å¼‚å¸¸å€¼", "ä½¿ç”¨3ÏƒåŸåˆ™è¯†åˆ«å¹¶å¤„ç†", 8),
        ("ç»Ÿä¸€æ ¼å¼", "æ ‡å‡†åŒ–æ—¥æœŸå’Œæ•°å€¼æ ¼å¼", 5),
    ]
    
    for step, method, count in cleaning_steps:
        print(f"\n  ğŸ”§ {step}")
        print(f"     æ–¹æ³•: {method}")
        print(f"     å¤„ç†: {count} æ¡")
        print(f"     âœ… å®Œæˆ")
    
    print("\næ¸…æ´—åæ•°æ®:")
    print(f"  âœ… æœ‰æ•ˆè®°å½•: {1000 - 12} æ¡")
    print(f"  âœ… æ•°æ®å®Œæ•´æ€§: 100%")
    print(f"  âœ… æ•°æ®ä¸€è‡´æ€§: å·²éªŒè¯")


def example_3_statistical_analysis():
    """ç¤ºä¾‹3: ç»Ÿè®¡åˆ†æ"""
    print("\n" + "="*60)
    print("ğŸ“ˆ ç¤ºä¾‹3: ç»Ÿè®¡åˆ†æ")
    print("="*60)
    
    # æ¨¡æ‹Ÿé”€å”®æ•°æ®ç»Ÿè®¡
    sales_stats = {
        "æ€»é”€å”®é¢": 1250000,
        "å¹³å‡è®¢å•é‡‘é¢": 2500,
        "æœ€å¤§è®¢å•": 50000,
        "æœ€å°è®¢å•": 100,
        "è®¢å•æ•°é‡": 500,
        "å®¢æˆ·æ•°é‡": 320,
    }
    
    print("\nåŸºç¡€ç»Ÿè®¡æŒ‡æ ‡:")
    print(f"\n  ğŸ’° æ€»é”€å”®é¢: Â¥{sales_stats['æ€»é”€å”®é¢']:,}")
    print(f"  ğŸ“Š å¹³å‡è®¢å•é‡‘é¢: Â¥{sales_stats['å¹³å‡è®¢å•é‡‘é¢']:,}")
    print(f"  ğŸ“ˆ æœ€å¤§è®¢å•: Â¥{sales_stats['æœ€å¤§è®¢å•']:,}")
    print(f"  ğŸ“‰ æœ€å°è®¢å•: Â¥{sales_stats['æœ€å°è®¢å•']:,}")
    print(f"  ğŸ›’ è®¢å•æ•°é‡: {sales_stats['è®¢å•æ•°é‡']}")
    print(f"  ğŸ‘¥ å®¢æˆ·æ•°é‡: {sales_stats['å®¢æˆ·æ•°é‡']}")
    
    # è¶‹åŠ¿åˆ†æ
    print("\n\næœˆåº¦è¶‹åŠ¿åˆ†æ:")
    monthly_trend = [
        ("1æœˆ", 95000, "â¬†ï¸ +12%"),
        ("2æœˆ", 88000, "â¬‡ï¸ -7%"),
        ("3æœˆ", 105000, "â¬†ï¸ +19%"),
        ("4æœˆ", 112000, "â¬†ï¸ +7%"),
        ("5æœˆ", 125000, "â¬†ï¸ +12%"),
    ]
    
    for month, amount, trend in monthly_trend:
        bar = "â–ˆ" * int(amount / 5000)
        print(f"  {month}: {bar} Â¥{amount:,} {trend}")
    
    # åˆ†ç±»ç»Ÿè®¡
    print("\n\näº§å“ç±»åˆ«é”€å”®å æ¯”:")
    categories = [
        ("ç”µå­äº§å“", 45, "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ"),
        ("æœè£…é…é¥°", 28, "â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ"),
        ("å®¶å±…ç”¨å“", 18, "â–ˆâ–ˆâ–ˆâ–Œ"),
        ("å…¶ä»–", 9, "â–ˆâ–Š"),
    ]
    
    for category, percentage, bar in categories:
        print(f"  {category}: {bar} {percentage}%")


def example_4_data_visualization():
    """ç¤ºä¾‹4: æ•°æ®å¯è§†åŒ–"""
    print("\n" + "="*60)
    print("ğŸ“Š ç¤ºä¾‹4: æ•°æ®å¯è§†åŒ–")
    print("="*60)
    
    print("\næ”¯æŒçš„å›¾è¡¨ç±»å‹:")
    
    chart_types = [
        {
            "name": "æŸ±çŠ¶å›¾ (Bar Chart)",
            "use_case": "å¯¹æ¯”ä¸åŒç±»åˆ«çš„æ•°å€¼",
            "example": "æœˆåº¦é”€å”®é¢å¯¹æ¯”"
        },
        {
            "name": "æŠ˜çº¿å›¾ (Line Chart)",
            "use_case": "å±•ç¤ºæ•°æ®éšæ—¶é—´çš„å˜åŒ–è¶‹åŠ¿",
            "example": "ç”¨æˆ·å¢é•¿è¶‹åŠ¿"
        },
        {
            "name": "é¥¼å›¾ (Pie Chart)",
            "use_case": "å±•ç¤ºå„éƒ¨åˆ†å æ•´ä½“çš„æ¯”ä¾‹",
            "example": "å¸‚åœºä»½é¢åˆ†å¸ƒ"
        },
        {
            "name": "æ•£ç‚¹å›¾ (Scatter Plot)",
            "use_case": "åˆ†æä¸¤ä¸ªå˜é‡ä¹‹é—´çš„å…³ç³»",
            "example": "ä»·æ ¼ä¸é”€é‡å…³ç³»"
        },
        {
            "name": "çƒ­åŠ›å›¾ (Heatmap)",
            "use_case": "å±•ç¤ºçŸ©é˜µæ•°æ®çš„åˆ†å¸ƒæ¨¡å¼",
            "example": "ä¸åŒæ—¶æ®µçš„è®¿é—®é‡"
        },
    ]
    
    for i, chart in enumerate(chart_types, 1):
        print(f"\n  {i}. {chart['name']}")
        print(f"     é€‚ç”¨åœºæ™¯: {chart['use_case']}")
        print(f"     ç¤ºä¾‹: {chart['example']}")
        print(f"     âœ… æ”¯æŒå¯¼å‡ºä¸º PNG/SVG/PDF")


def example_5_advanced_analysis():
    """ç¤ºä¾‹5: é«˜çº§åˆ†æ"""
    print("\n" + "="*60)
    print("ğŸ”¬ ç¤ºä¾‹5: é«˜çº§åˆ†æ")
    print("="*60)
    
    print("\n1ï¸âƒ£ ç›¸å…³æ€§åˆ†æ")
    print("="*50)
    
    correlations = [
        ("å¹¿å‘Šæ”¯å‡º", "é”€å”®é¢", 0.85, "å¼ºæ­£ç›¸å…³"),
        ("ä»·æ ¼", "é”€é‡", -0.62, "ä¸­åº¦è´Ÿç›¸å…³"),
        ("å®¢æˆ·æ»¡æ„åº¦", "å¤è´­ç‡", 0.78, "å¼ºæ­£ç›¸å…³"),
    ]
    
    for var1, var2, corr, desc in correlations:
        print(f"\n  {var1} â†” {var2}")
        print(f"  ç›¸å…³ç³»æ•°: {corr}")
        print(f"  å…³ç³»: {desc}")
    
    print("\n\n2ï¸âƒ£ é¢„æµ‹åˆ†æ")
    print("="*50)
    
    prediction = {
        "æ¨¡å‹": "çº¿æ€§å›å½’",
        "è®­ç»ƒæ•°æ®": "è¿‡å»12ä¸ªæœˆé”€å”®æ•°æ®",
        "é¢„æµ‹ç›®æ ‡": "ä¸‹æœˆé”€å”®é¢",
        "é¢„æµ‹ç»“æœ": "Â¥135,000",
        "ç½®ä¿¡åŒºé—´": "Â¥128,000 - Â¥142,000",
        "æ¨¡å‹å‡†ç¡®åº¦": "92%"
    }
    
    print(f"\n  ä½¿ç”¨æ¨¡å‹: {prediction['æ¨¡å‹']}")
    print(f"  è®­ç»ƒæ•°æ®: {prediction['è®­ç»ƒæ•°æ®']}")
    print(f"  é¢„æµ‹ç›®æ ‡: {prediction['é¢„æµ‹ç›®æ ‡']}")
    print(f"  é¢„æµ‹ç»“æœ: {prediction['é¢„æµ‹ç»“æœ']}")
    print(f"  ç½®ä¿¡åŒºé—´: {prediction['ç½®ä¿¡åŒºé—´']}")
    print(f"  å‡†ç¡®åº¦: {prediction['æ¨¡å‹å‡†ç¡®åº¦']}")
    
    print("\n\n3ï¸âƒ£ å¼‚å¸¸æ£€æµ‹")
    print("="*50)
    
    anomalies = [
        {"date": "2025-10-05", "value": 8500, "expected": 12000, "deviation": "-29%"},
        {"date": "2025-10-12", "value": 25000, "expected": 12000, "deviation": "+108%"},
    ]
    
    print("\n  æ£€æµ‹åˆ°å¼‚å¸¸æ•°æ®ç‚¹:")
    for anomaly in anomalies:
        print(f"\n  âš ï¸  æ—¥æœŸ: {anomaly['date']}")
        print(f"     å®é™…å€¼: Â¥{anomaly['value']:,}")
        print(f"     é¢„æœŸå€¼: Â¥{anomaly['expected']:,}")
        print(f"     åå·®: {anomaly['deviation']}")


def example_6_report_generation():
    """ç¤ºä¾‹6: æŠ¥å‘Šç”Ÿæˆ"""
    print("\n" + "="*60)
    print("ğŸ“ ç¤ºä¾‹6: è‡ªåŠ¨æŠ¥å‘Šç”Ÿæˆ")
    print("="*60)
    
    print("\nç”Ÿæˆé”€å”®åˆ†ææŠ¥å‘Š...")
    
    report_sections = [
        ("1. æ‰§è¡Œæ‘˜è¦", "æ€»ä½“ä¸šç»©æ¦‚è¿°å’Œå…³é”®å‘ç°"),
        ("2. é”€å”®ä¸šç»©", "è¯¦ç»†é”€å”®æ•°æ®å’Œè¶‹åŠ¿åˆ†æ"),
        ("3. äº§å“åˆ†æ", "å„äº§å“ç±»åˆ«è¡¨ç°å¯¹æ¯”"),
        ("4. å®¢æˆ·åˆ†æ", "å®¢æˆ·ç¾¤ä½“ç‰¹å¾å’Œè¡Œä¸º"),
        ("5. å¸‚åœºè¶‹åŠ¿", "å¸‚åœºå˜åŒ–å’Œç«äº‰æ€åŠ¿"),
        ("6. å»ºè®®æªæ–½", "åŸºäºæ•°æ®çš„è¡ŒåŠ¨å»ºè®®"),
    ]
    
    print("\næŠ¥å‘Šç»“æ„:")
    for section, description in report_sections:
        print(f"\n  {section}")
        print(f"  â””â”€ {description}")
        print(f"     âœ… å·²ç”Ÿæˆ")
    
    print("\n\næŠ¥å‘Šè¾“å‡ºæ ¼å¼:")
    formats = [
        "ğŸ“„ PDF - é€‚åˆæ‰“å°å’Œåˆ†äº«",
        "ğŸ“Š Excel - åŒ…å«åŸå§‹æ•°æ®å’Œå›¾è¡¨",
        "ğŸ“ Word - å¯ç¼–è¾‘çš„æ–‡æ¡£æ ¼å¼",
        "ğŸŒ HTML - äº¤äº’å¼ç½‘é¡µæŠ¥å‘Š",
    ]
    
    for fmt in formats:
        print(f"  {fmt}")
    
    print("\nâœ… æŠ¥å‘Šç”Ÿæˆå®Œæˆ!")
    print("   ä¿å­˜ä½ç½®: reports/sales_analysis_202510.pdf")


def example_7_complete_workflow():
    """ç¤ºä¾‹7: å®Œæ•´æ•°æ®åˆ†æå·¥ä½œæµ"""
    print("\n" + "="*60)
    print("ğŸ”„ ç¤ºä¾‹7: å®Œæ•´æ•°æ®åˆ†æå·¥ä½œæµ")
    print("="*60)
    
    print("\nåœºæ™¯: æœˆåº¦é”€å”®æ•°æ®åˆ†æ")
    print("\nå·¥ä½œæµç¨‹:")
    
    workflow = [
        ("æ•°æ®æ”¶é›†", [
            "ä»CRMç³»ç»Ÿå¯¼å‡ºé”€å”®æ•°æ®",
            "ä»ERPç³»ç»Ÿå¯¼å‡ºåº“å­˜æ•°æ®",
            "ä»ç½‘ç«™è·å–è®¿é—®ç»Ÿè®¡"
        ]),
        ("æ•°æ®é¢„å¤„ç†", [
            "åˆå¹¶å¤šä¸ªæ•°æ®æº",
            "æ¸…æ´—å¼‚å¸¸å’Œç¼ºå¤±å€¼",
            "æ•°æ®æ ¼å¼æ ‡å‡†åŒ–"
        ]),
        ("æ¢ç´¢æ€§åˆ†æ", [
            "è®¡ç®—åŸºç¡€ç»Ÿè®¡æŒ‡æ ‡",
            "è¯†åˆ«æ•°æ®åˆ†å¸ƒç‰¹å¾",
            "å‘ç°æ½œåœ¨è§„å¾‹"
        ]),
        ("æ·±åº¦åˆ†æ", [
            "é”€å”®è¶‹åŠ¿åˆ†æ",
            "å®¢æˆ·ç¾¤ä½“ç»†åˆ†",
            "äº§å“å…³è”åˆ†æ"
        ]),
        ("å¯è§†åŒ–", [
            "åˆ›å»ºäº¤äº’å¼å›¾è¡¨",
            "è®¾è®¡æ•°æ®ä»ªè¡¨æ¿",
            "ç”Ÿæˆå¯è§†åŒ–æŠ¥å‘Š"
        ]),
        ("æ´å¯Ÿæå–", [
            "è¯†åˆ«å…³é”®å‘ç°",
            "æå‡ºä¸šåŠ¡å»ºè®®",
            "åˆ¶å®šè¡ŒåŠ¨è®¡åˆ’"
        ])
    ]
    
    for i, (phase, tasks) in enumerate(workflow, 1):
        print(f"\n  é˜¶æ®µ {i}: {phase}")
        for task in tasks:
            print(f"    â€¢ {task}")
        print(f"    âœ… å®Œæˆ")
    
    print("\n" + "="*50)
    print("ğŸ“Š åˆ†ææˆæœ:")
    print("="*50)
    print("""
  å…³é”®å‘ç°:
  â€¢ æœ¬æœˆé”€å”®é¢åŒæ¯”å¢é•¿ 18%
  â€¢ ç”µå­äº§å“ç±»åˆ«è¡¨ç°çªå‡º
  â€¢ æ–°å®¢æˆ·è½¬åŒ–ç‡æå‡ 12%
  â€¢ å¤è´­ç‡è¾¾åˆ° 65%
  
  è¡ŒåŠ¨å»ºè®®:
  1. åŠ å¤§ç”µå­äº§å“ç±»ç›®è¥é”€æŠ•å…¥
  2. ä¼˜åŒ–æ–°å®¢æˆ·å¼•æµæ¸ é“
  3. å»ºç«‹å®¢æˆ·å¿ è¯šåº¦è®¡åˆ’
  4. è°ƒæ•´åº“å­˜ç»“æ„
    """)


def main():
    """ä¸»å‡½æ•°"""
    print("\n" + "="*70)
    print("ğŸ“Š æ•°æ®åˆ†ææ™ºèƒ½ä½“ä½¿ç”¨ç¤ºä¾‹")
    print("="*70)
    
    print("\næœ¬ç¤ºä¾‹å±•ç¤ºæ•°æ®åˆ†ææ™ºèƒ½ä½“çš„å„ç§åŠŸèƒ½")
    print("åŒ…æ‹¬æ•°æ®åŠ è½½ã€æ¸…æ´—ã€åˆ†æã€å¯è§†åŒ–å’ŒæŠ¥å‘Šç”Ÿæˆç­‰")
    print()
    
    try:
        example_1_load_data()
        example_2_data_cleaning()
        example_3_statistical_analysis()
        example_4_data_visualization()
        example_5_advanced_analysis()
        example_6_report_generation()
        example_7_complete_workflow()
        
        print("\n" + "="*70)
        print("âœ… æ‰€æœ‰ç¤ºä¾‹è¿è¡Œå®Œæˆ!")
        print("="*70)
        
        print("\nğŸ’¡ åŠŸèƒ½æ€»ç»“:")
        print("   1. æ•°æ®åŠ è½½ - æ”¯æŒå¤šç§æ ¼å¼")
        print("   2. æ•°æ®æ¸…æ´— - è‡ªåŠ¨å¤„ç†è´¨é‡é—®é¢˜")
        print("   3. ç»Ÿè®¡åˆ†æ - è®¡ç®—å…³é”®æŒ‡æ ‡")
        print("   4. æ•°æ®å¯è§†åŒ– - å¤šç§å›¾è¡¨ç±»å‹")
        print("   5. é«˜çº§åˆ†æ - ç›¸å…³æ€§/é¢„æµ‹/å¼‚å¸¸æ£€æµ‹")
        print("   6. æŠ¥å‘Šç”Ÿæˆ - è‡ªåŠ¨åŒ–æŠ¥å‘Šè¾“å‡º")
        print("   7. å®Œæ•´å·¥ä½œæµ - ç«¯åˆ°ç«¯åˆ†ææµç¨‹")
        
        print("\nğŸ¯ åº”ç”¨åœºæ™¯:")
        print("   â€¢ é”€å”®ä¸šç»©åˆ†æ")
        print("   â€¢ å®¢æˆ·è¡Œä¸ºåˆ†æ")
        print("   â€¢ è´¢åŠ¡æ•°æ®åˆ†æ")
        print("   â€¢ è¿è¥æŒ‡æ ‡ç›‘æ§")
        print("   â€¢ å¸‚åœºè¶‹åŠ¿ç ”ç©¶")
        print()
        
    except Exception as e:
        print(f"\nâŒ è¿è¡Œå‡ºé”™: {e}")
        import traceback
        traceback.print_exc()


if __name__ == "__main__":
    main()

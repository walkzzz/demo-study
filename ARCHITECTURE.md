# 日常办公超级智能体 - 架构说明

## 系统架构图

```
┌─────────────────────────────────────────────────────────────┐
│                        用户交互层                             │
│  ┌──────────────┐              ┌──────────────┐             │
│  │  命令行界面   │              │  Web API     │             │
│  │   (CLI)      │              │  (FastAPI)   │             │
│  └──────────────┘              └──────────────┘             │
└─────────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────────┐
│                      智能体编排层                             │
│  ┌──────────────────────────────────────────────────────┐   │
│  │              超级智能体协调器                          │   │
│  │   (任务理解 → 任务分解 → 智能体路由 → 结果聚合)        │   │
│  └──────────────────────────────────────────────────────┘   │
│  ┌──────────────┐              ┌──────────────┐             │
│  │  任务规划器   │              │  状态管理器   │             │
│  └──────────────┘              └──────────────┘             │
└─────────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────────┐
│                      专业智能体层                             │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐          │
│  │邮件 │ │文档 │ │日程 │ │数据 │ │知识 │ │文件 │          │
│  │智能│ │智能│ │智能│ │智能│ │智能│ │智能│          │
│  │体  │ │体  │ │体  │ │体  │ │体  │ │体  │          │
│  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘          │
└─────────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────────┐
│                         工具层                                │
│  ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐ ┌─────┐          │
│  │邮件 │ │文件 │ │日历 │ │数据 │ │网络 │ │文件 │          │
│  │工具 │ │处理 │ │工具 │ │分析 │ │搜索 │ │系统 │          │
│  │集  │ │工具 │ │集  │ │工具 │ │工具 │ │工具 │          │
│  └─────┘ └─────┘ └─────┘ └─────┘ └─────┘ └─────┘          │
└─────────────────────────────────────────────────────────────┘
                           ↓
┌─────────────────────────────────────────────────────────────┐
│                      基础设施层                               │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐   │
│  │  Ollama  │  │  向量    │  │  记忆    │  │  缓存    │   │
│  │  模型    │  │  数据库  │  │  存储    │  │  系统    │   │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘   │
└─────────────────────────────────────────────────────────────┘
```

## 核心模块说明

### 1. 用户交互层 (src/cli, src/api)

- **CLI**: 命令行交互界面
- **API**: RESTful API服务

### 2. 智能体编排层 (src/orchestrator)

- **SuperAgent**: 超级智能体协调器
- **TaskPlanner**: 任务规划和分解
- **StateManager**: 状态流转管理 ([使用指南](docs/STATE_MANAGER_GUIDE.md))

### 3. 专业智能体层 (src/agents)

- **EmailAgent**: 邮件处理
- **DocAgent**: 文档处理
- **ScheduleAgent**: 日程管理
- **DataAgent**: 数据分析
- **KnowledgeAgent**: 知识问答
- **FileAgent**: 文件系统管理

### 4. 工具层 (src/tools)

- **EmailTools**: 邮件读取、发送、分类
- **FileTools**: 文档加载、转换、对比
- **CalendarTools**: 日程CRUD、时间建议
- **DataTools**: 数据加载、分析、可视化
- **WebTools**: 网络搜索
- **FileSystemTools**: 文件扫描、分类、整理

### 5. 基础设施层 (src/core)

- **ModelManager**: Ollama模型管理
- **PromptEngine**: 提示词模板引擎
- **MemoryManager**: 记忆系统
- **VectorDBManager**: 向量数据库

## 数据流

```
用户输入
  ↓
任务理解 (LLM)
  ↓
任务分解
  ↓
智能体选择
  ↓
工具调用
  ↓
结果验证
  ↓
反思优化 (如需要)
  ↓
结果聚合
  ↓
返回用户
```

## 配置文件

- `config/config.yaml`: 主配置
- `config/agents.yaml`: 智能体配置
- `config/file_rules.json`: 文件分类规则

## 数据目录

- `data/vectordb/`: 向量数据库
- `data/memory/`: 记忆存储
- `data/backups/`: 文件备份
- `data/cache/`: 缓存数据

## 技术栈

- **框架**: LangChain, LangGraph
- **模型**: Ollama (Llama3, Qwen, Mistral)
- **向量DB**: ChromaDB
- **Web**: FastAPI
- **语言**: Python 3.10+
